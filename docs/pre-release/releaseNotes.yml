# This file should be placed in the folder for the version of the
# product that's meant to be documented. A `/release-notes` page will
# be automatically generated and populated at build time.
#
# Note that an entry needs to be added to the `doc-links.yml` file in
# order to surface the release notes in the table of contents.
#
# The YAML in this file should contain:
#
# changelog: An (optional) URL to the CHANGELOG for the product.
# items: An array of releases with the following attributes:
#     - version: The (optional) version number of the release, if applicable.
#     - date: The date of the release in the format YYYY-MM-DD.
#     - notes: An array of noteworthy changes included in the release, each having the following attributes:
#         - title: A short title of the noteworthy change.
#         - body: Two or three sentences describing the change and why it is noteworthy. This is in rich text format and may contain HTML elements.
#         - image: The URL of an image that visually represents the noteworthy change.
#         - docs: The path to the documentation page where additional information can be found.
#         - type: The type of change, one of `bugfix`, `feature`, `security` or `change`.
#

docTitle: Telepresence Release Notes
docDescription: >-
  Release notes for Telepresence by Ambassador Labs, a CNCF project
  that enables developers to iterate rapidly on Kubernetes
  microservices by arming them with infinite-scale development
  environments, access to instantaneous feedback loops, and highly
  customizable development environments.

changelog: https://github.com/telepresenceio/telepresence/blob/$branch$/CHANGELOG.md

items:
  - version: 2.y.z
    date: 'TBD'
    notes:
      # Headliners
      - type: feature
        title: No more dependence on <code>kubectl</code>
        body: >-
          Telepresence no longer depends on having an external
          <code>kubectl</code> binary, which might not be present for
          OpenShift users (who have <code>oc</code> instead of
          <code>kubectl</code>).
      - type: feature
        title: Traffic-manager Helm Chart
        body: >-
          We now support installing the traffic-manager via helm.
          This will make it easier for operators to see what the
          traffic-manager needs to install so that telepresence works
          correctly, as well as providing a more direct route to customizing
          installation.
        image: ./telepresence-2.3.3-helm.png
        docs: install/helm/
      - type: feature
        title: Traffic-manager in custom namespace
        body: >-
          As the traffic manager can now be installed in any namespace via helm,
          telepresence can now be configured to look for the traffic manager in
          a namespace other than <code>ambassador</code>. This can be configured
          on a per-cluster basis.
        # image: TODO
        docs: reference/config
      - type: feature
        title: Traffic-manager in multiple namespaces
        body: >-
          We now support installing multiple traffic managers in the same cluster.
          This will allow operators to install deployments of telepresence that are
          limited to certain namespaces.
        # image: TODO
        docs: reference/config
      - type: feature
        title: Agent image now configurable
        body: >-
          We now support configuring which agent image + registry to use in the
          config. This enables users whose laptop is an air-gapped environment to
          create selective intercepts without requiring a login. It also makes it easier
          for those who are developing on Telepresence to specify which agent image should
          be used.
        # image: TODO
        docs: reference/config
      - type: bugfix
        title: Intercepts will survive deletion of intercepted pod
        body: >-
          An intercept will survive deletion of the intercepted pod provided that another
          pod is created (or already exists) that can take over.
  - version: 2.3.2
    date: '2021-06-18'
    notes:
      # Headliners
      - type: feature
        title: Service Port Annotation
        body: >-
          The mutator webhook for injecting traffic-agents now
          recognizes a
          <code>telepresence.getambassador.io/inject-service-port</code>
          annotation to specify which port to intercept; bringing the
          functionality of the <code>--port</code> flag to users who
          use the mutator webook in order to control Telepresence via
          GitOps.
        image: ./telepresence-2.3.2-svcport-annotation.png
        docs: reference/cluster-config#service-port-annotation
      - type: feature
        title: Outbound Connections
        body: >-
          Outbound connections are now routed through the intercepted
          Pods which means that the connections originate from that
          Pod from the cluster's perspective.  This allows service
          meshes to correctly identify the traffic.
        docs: reference/routing/#outbound
      - type: change
        title: Inbound Connections
        body: >-
          Inbound connections from an intercepted agent are now
          tunneled to the manager over the existing gRPC connection,
          instead of establishing a new connection to the manager for
          each inbound connection.  This avoids interference from
          certain service mesh configurations.
        docs: reference/routing/#inbound

      # RBAC changes
      - type: change
        title: Traffic-manager needs new RBAC permissions
        body: >-
          The traffic-manager requires <a href="reference/rbac">RBAC
          permissions</a> to list Nodes, Pods, and to create a dummy
          Service in the manager's namespace.
        docs: reference/routing/#subnets
      - type: change
        title: Reduced developer RBAC requirements
        body: >-
          The on-laptop client no longer requires <a
          href="reference/rbac">RBAC permissions</a> to list the Nodes
          in the cluster or to create Services, as that functionality
          has been moved to the traffic-manager.

      # Bugfixes
      - type: bugfix
        title: Able to detect subnets
        body: >-
          Telepresence will now detect the Pod CIDR ranges even if
          they are not listed in the Nodes.
        image: ./telepresence-2.3.2-subnets.png
        docs: reference/routing/#subnets
      - type: bugfix
        title: Dynamic IP ranges
        body: >-
          The list of cluster subnets that the virtual network
          interface will route is now configured dynamically and will
          follow changes in the cluster.
      - type: bugfix
        title: No duplicate subnets
        body: >-
          Subnets fully covered by other subnets are now pruned
          internally and thus never superfluously added to the
          laptop's routing table.
        docs: reference/routing/#subnets
      - type: change # not a bugfix, but it only makes sense to mention after the above bugfixes
        title: Change in default timeout
        body: >-
          The <code>trafficManagerAPI</code> timeout default has
          changed from 5 seconds to 15 seconds, in order to facilitate
          the extended time it takes for the traffic-manager to do its
          initial discovery of cluster info as a result of the above
          bugfixes.
      - type: bugfix
        title: Removal of DNS config files on macOS
        body: >-
          On macOS, files generated under
          <code>/etc/resolver/</code> as the result of using
          <code>include-suffixes</code> in the cluster config are now
          properly removed on quit.
        docs: reference/routing/#mac-os-resolver

      - type: bugfix
        title: Large file transfers
        body: >-
          Telepresence no longer erroneously terminates connections
          early when sending a large HTTP response from an intercepted
          service.
      - type: bugfix
        title: Race condition in shutdown
        body: >-
          When shutting down the user-daemon or root-daemon on the
          laptop, <code>telepresence quit</code> and related commands
          no longer return early before everything is fully shut down.
          Now it can be counted on that by the time the command has
          returned that all of the side-effects on the laptop have
          been cleaned up.

  - version: 2.3.1
    date: '2021-06-14'
    notes:
      - title: DNS Resolver Configuration
        body: "Telepresence now supports per-cluster configuration for custom dns behavior, which will enable users to determine which local + remote resolver to use and which suffixes should be ignored + included. These can be configured on a per-cluster basis."
        image: ./telepresence-2.3.1-dns.png
        docs: reference/config
        type: feature
      - title: AlsoProxy Configuration
        body: "Telepresence now supports also proxying user-specified subnets so that they can access external services only accessible to the cluster while connected to Telepresence. These can be configured on a per-cluster basis and each subnet is added to the TUN device so that requests are routed to the cluster for IPs that fall within that subnet."
        image: ./telepresence-2.3.1-alsoProxy.png
        docs: reference/config
        type: feature
      - title: Mutating Webhook for Injecting Traffic Agents
        body: "The Traffic Manager now contains a mutating webhook to automatically add an agent to pods that have the <code>telepresence.getambassador.io/traffic-agent: enabled</code> annotation.  This enables Telepresence to work well with GitOps CD platforms that rely on higher level kubernetes objects matching what is stored in git.  For workloads without the annotation, Telepresence will add the agent the way it has in the past"
        image: ./telepresence-2.3.1-inject.png
        docs: reference/rbac
        type: feature
      - title: Traffic Manager Connect Timeout
        body: "The trafficManagerConnect timeout default has changed from 20 seconds to 60 seconds, in order to facilitate the extended time it takes to apply everything needed for the mutator webhook."
        image: ./telepresence-2.3.1-trafficmanagerconnect.png
        docs: reference/config
        type: change
      - title: Fix for large file transfers
        body: "Fix a tun-device bug where sometimes large transfers from services on the cluster would hang indefinitely"
        image: ./telepresence-2.3.1-large-file-transfer.png
        docs: reference/tun-device
        type: bugfix
      - title: Brew Formula Changed
        body: "Now that the Telepresence rewrite is the main version of Telepresence, you can install it via Brew like so: <code>brew install datawire/blackbird/telepresence</code>."
        image: ./telepresence-2.3.1-brew.png
        docs: install/
        type: change
  - version: 2.3.0
    date: '2021-06-01'
    notes:
      - title: Brew install Telepresence
        body: "Telepresence can now be installed via brew on macOS, which makes it easier for users to stay up-to-date with the latest telepresence version. To install via brew, you can use the following command: <code>brew install datawire/blackbird/telepresence2</code>."
        image: ./telepresence-2.3.0-homebrew.png
        docs: install/
        type: feature
      - title: TCP and UDP routing via Virtual Network Interface
        body: "Telepresence will now perform routing of outbound TCP and UDP traffic via a Virtual Network Interface (VIF). The VIF is a layer 3 TUN-device that exists while Telepresence is connected. It makes the subnets in the cluster available to the workstation and will also route DNS requests to the cluster and forward them to intercepted pods. This means that pods with custom DNS configuration will work as expected. Prior versions of Telepresence would use firewall rules and were only capable of routing TCP."
        image: ./tunnel.jpg
        docs: reference/tun-device
        type: feature
      - title: SSH is no longer used
        body: "All traffic between the client and the cluster is now tunneled via the traffic manager gRPC API. This means that Telepresence no longer uses ssh tunnels and that the manager no longer have an <code>sshd</code> installed. Volume mounts are still established using <code>sshfs</code> but it is now configured to communicate using the sftp-protocol directly, which means that the traffic agent also runs without <code>sshd</code>. A desired side effect of this is that the manager and agent containers no longer need a special user configuration."
        image: ./no-ssh.png
        docs: reference/tun-device/#no-ssh-required
        type: change
      - title: Running in a Docker container
        body: "Telepresence can now be run inside a Docker container. This can be useful for avoiding side effects on a workstation's network, establishing multiple sessions with the traffic manager, or working with different clusters simultaneously."
        image: ./run-tp-in-docker.png
        docs: reference/inside-container
        type: feature
      - title: Configurable Log Levels
        body: "Telepresence now supports configuring the log level for Root Daemon and User Daemon logs. This provides control over the nature and volume of information that Telepresence generates in <code>daemon.log</code> and <code>connector.log</code>."
        image: ./telepresence-2.3.0-loglevels.png
        docs: reference/config/#log-levels
        type: feature
  - version: 2.2.2
    date: '2021-05-17'
    notes:
      - title: Legacy Telepresence subcommands
        body: Telepresence is now able to translate common legacy Telepresence commands into native Telepresence commands. So if you want to get started quickly, you can just use the same legacy Telepresence commands you are used to with the new Telepresence binary.
        image: ./telepresence-2.2.png
        docs: install/migrate-from-legacy/
        type: feature
